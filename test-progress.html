<!DOCTYPE html>
<html>
<head>
    <title>Test Progress</title>
    <style>
        body { background: #000; color: #0f0; font-family: monospace; padding: 20px; }
        #log { border: 1px solid #0f0; padding: 10px; height: 400px; overflow-y: auto; }
        .progress { margin: 20px 0; }
        .bar { width: 100%; height: 30px; background: #111; border: 1px solid #0f0; }
        .fill { height: 100%; background: #0f0; transition: width 0.3s; }
    </style>
</head>
<body>
    <h1>Whisper Model Download Progress Test</h1>
    <div class="progress">
        <div>Progress: <span id="percent">0</span>%</div>
        <div class="bar"><div class="fill" id="bar" style="width: 0%"></div></div>
    </div>
    <div id="log"></div>

    <script type="module">
        const log = (msg) => {
            const div = document.createElement('div');
            div.textContent = `[${new Date().toLocaleTimeString()}] ${msg}`;
            document.getElementById('log').appendChild(div);
            document.getElementById('log').scrollTop = document.getElementById('log').scrollHeight;
        };

        // Create worker
        const worker = new Worker('/packages/susurro/src/workers/whisper-pipeline.worker.js', { type: 'module' });
        
        worker.onmessage = (e) => {
            const { status, progress, file, loaded, total } = e.data;
            
            if (status === 'progress') {
                const percent = Math.round(progress || 0);
                document.getElementById('percent').textContent = percent;
                document.getElementById('bar').style.width = percent + '%';
                
                let msg = `üì• ${file}: ${percent}%`;
                if (loaded && total) {
                    const mb = (total / 1024 / 1024).toFixed(1);
                    msg += ` (${mb} MB)`;
                }
                log(msg);
            } else if (status === 'loaded') {
                log('‚úÖ Model loaded successfully!');
            } else if (status === 'error') {
                log('‚ùå Error: ' + e.data.error);
            }
        };

        // Start loading
        log('Starting model download...');
        worker.postMessage({ id: 1, type: 'load', data: { model: 'tiny' } });
    </script>
</body>
</html>